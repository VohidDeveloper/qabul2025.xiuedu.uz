import{u as E,_ as L,d as ee,c as te,e as oe,a as ae,f as se}from"./useProjects-WiECl9T6.js";import{g as F,r as l,e as r,k as S,Q as N,w as i,c as b,B as A,F as q,d as o,a as c,t as k,u as s,G as P,j as G,f as B,J as I,i as R,h as T,K as ne,R as le}from"./index-BZ-BXCh5.js";import{u as re}from"./useModal-BDe3LOF0.js";import{u as ie}from"./useToast-CM91r3xC.js";const M=F({__name:"ProjectStatusBadge",props:{status:{type:String,required:!0}},setup(y){const g={"in progress":"primary",archived:"secondary",completed:"success",important:"warning"};return(u,v)=>{const n=l("VaBadge");return r(),S(n,{square:"",color:g[u.$props.status],text:u.$props.status.toUpperCase()},null,8,["color","text"])}}}),de={class:"text-[var(--va-secondary)]"},ue={class:"flex flex-col items-center gap-4 grow"},ce={class:"va-h4 text-center self-stretch overflow-hidden line-clamp-2 text-ellipsis"},pe={key:0},me={class:"flex justify-between"},ge={key:1,class:"p-4 flex justify-center items-center text-[var(--va-secondary)]"},ve=F({__name:"ProjectCards",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0}},emits:["edit","delete"],setup(y){const{getUserById:g,getTeamOptions:u}=N("ProjectsPage");return(v,n)=>{const w=l("VaAvatarGroup"),x=l("VaDivider"),p=l("VaButton"),f=l("VaCardContent"),$=l("VaCard"),a=l("VaInnerLoading");return y.projects.length>0||y.loading?(r(),S(a,{key:0,loading:y.loading,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[4rem]"},{default:i(()=>[(r(!0),b(q,null,A(y.projects,t=>(r(),S($,{key:t.project_name,style:{"--va-card-outlined-border":"1px solid var(--va-background-element)"},outlined:""},{default:i(()=>[o(f,{class:"flex flex-col h-full"},{default:i(()=>[c("div",de,k(new Date(t.created_at).toLocaleDateString()),1),c("div",ue,[c("h4",ce,k(t.project_name),1),c("p",null,[n[0]||(n[0]=c("span",{class:"text-[var(--va-secondary)]"},"Owner: ",-1)),s(g)(t.project_owner)?(r(),b("span",pe,k(s(g)(t.project_owner).fullname),1)):P("",!0)]),o(w,{class:"my-4",options:s(u)(t.team),max:5},null,8,["options"]),o(M,{status:t.status},null,8,["status"])]),o(x,{class:"my-6"}),c("div",me,[o(p,{preset:"secondary",icon:"mso-edit",color:"secondary",onClick:j=>v.$emit("edit",t)},null,8,["onClick"]),o(p,{preset:"secondary",icon:"mso-delete",color:"danger",onClick:j=>v.$emit("delete",t)},null,8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["loading"])):(r(),b("div",ge,"No projects"))}}}),fe={class:"ellipsis max-w-[230px] lg:max-w-[450px]"},ye={key:0,class:"flex items-center gap-2 ellipsis max-w-[230px]"},_e={class:"flex gap-2 justify-end"},be={class:"flex flex-col-reverse md:flex-row gap-2 justify-between items-center py-2"},je={key:0,class:"flex"},Ve=F({__name:"ProjectsTable",props:{projects:{type:Array,required:!0},loading:{type:Boolean,required:!0},sortBy:{type:String,default:void 0},sortingOrder:{type:String,default:void 0},pagination:{type:Object,required:!0}},emits:["edit","delete"],setup(y,{emit:g}){const u=ee([{label:"Project name",key:"project_name",sortable:!0},{label:"Project owner",key:"project_owner",sortable:!0},{label:"Team",key:"team",sortable:!0},{label:"Status",key:"status",sortable:!0},{label:"Creation Date",key:"created_at",sortable:!0},{label:" ",key:"actions"}]),v=y,n=g,w=E(v,"sortBy",n),x=E(v,"sortingOrder",n),p=G(()=>Math.ceil(v.pagination.total/v.pagination.perPage)),{getUserById:f,getTeamOptions:$}=N("ProjectsPage");return(a,t)=>{const j=l("VaAvatarGroup"),m=l("VaButton"),U=l("VaDataTable"),h=l("VaSelect"),D=l("VaPagination");return r(),b("div",null,[o(U,{"sort-by":s(w),"onUpdate:sortBy":t[0]||(t[0]=e=>I(w)?w.value=e:null),"sorting-order":s(x),"onUpdate:sortingOrder":t[1]||(t[1]=e=>I(x)?x.value=e:null),items:y.projects,columns:s(u),loading:y.loading},{"cell(project_name)":i(({rowData:e})=>[c("div",fe,k(e.project_name),1)]),"cell(project_owner)":i(({rowData:e})=>[s(f)(e.project_owner)?(r(),b("div",ye,[o(L,{user:s(f)(e.project_owner),size:"small"},null,8,["user"]),B(" "+k(s(f)(e.project_owner).fullname),1)])):P("",!0)]),"cell(team)":i(({rowData:e})=>[o(j,{size:"small",options:s($)(e.team),max:5},null,8,["options"])]),"cell(status)":i(({rowData:e})=>[o(M,{status:e.status},null,8,["status"])]),"cell(created_at)":i(({rowData:e})=>[B(k(new Date(e.created_at).toLocaleDateString()),1)]),"cell(actions)":i(({rowData:e})=>[c("div",_e,[o(m,{preset:"primary",size:"small",color:"primary",icon:"mso-edit","aria-label":"Edit project",onClick:C=>a.$emit("edit",e)},null,8,["onClick"]),o(m,{preset:"primary",size:"small",icon:"mso-delete",color:"danger","aria-label":"Delete project",onClick:C=>a.$emit("delete",e)},null,8,["onClick"])])]),_:1},8,["sort-by","sorting-order","items","columns","loading"]),c("div",be,[c("div",null,[c("b",null,k(a.$props.pagination.total)+" results.",1),t[6]||(t[6]=B(" Results per page ")),o(h,{modelValue:a.$props.pagination.perPage,"onUpdate:modelValue":t[2]||(t[2]=e=>a.$props.pagination.perPage=e),class:"!w-20",options:[10,50,100]},null,8,["modelValue"])]),p.value>1?(r(),b("div",je,[o(m,{preset:"secondary",icon:"va-arrow-left","aria-label":"Previous page",disabled:a.$props.pagination.page===1,onClick:t[3]||(t[3]=e=>a.$props.pagination.page--)},null,8,["disabled"]),o(m,{class:"mr-2",preset:"secondary",icon:"va-arrow-right","aria-label":"Next page",disabled:a.$props.pagination.page===p.value,onClick:t[4]||(t[4]=e=>a.$props.pagination.page++)},null,8,["disabled"]),o(D,{modelValue:a.$props.pagination.page,"onUpdate:modelValue":t[5]||(t[5]=e=>a.$props.pagination.page=e),"buttons-preset":"secondary",pages:p.value,"visible-pages":5,"boundary-links":!1,"direction-links":!1},null,8,["modelValue","pages"])])):P("",!0)])])}}}),ke=R(Ve,[["__scopeId","data-v-b93c3aed"]]),we={class:"flex justify-end flex-col-reverse sm:flex-row mt-4 gap-2"},xe=F({__name:"EditProjectForm",props:{project:{},saveButtonLabel:{}},emits:["save","close"],setup(y,{expose:g}){const u=y,v={project_name:"",project_owner:void 0,team:[],status:void 0},n=T({...v}),w=G(()=>Object.keys(n.value).some(a=>{var t;return a==="team"?!1:n.value[a]!==((t=u.project??v)==null?void 0:t[a])}));g({isFormHasUnsavedChanges:w});const x=te();ne(()=>u.project,()=>{u.project&&(n.value={...u.project,project_owner:u.project.project_owner})},{immediate:!0});const p=a=>!!a||"This field is required",f=T(""),$=T("");return(a,t)=>{const j=l("VaInput"),m=l("VaSelect"),U=l("VaButton"),h=l("VaForm");return r(),S(h,{class:"flex flex-col gap-2"},{default:i(({validate:D})=>[o(j,{modelValue:n.value.project_name,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.project_name=e),label:"Project name",rules:[p]},null,8,["modelValue","rules"]),o(m,{modelValue:n.value.project_owner,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.project_owner=e),search:f.value,"onUpdate:search":t[2]||(t[2]=e=>f.value=e),searchable:"",label:"Owner","text-by":"fullname","track-by":"id","value-by":"id",rules:[p],options:s(x).items},{content:i(({value:e})=>[e?(r(),b("div",{key:e.id,class:"flex items-center gap-1 mr-4"},[P("",!0),B(" "+k(e.fullname),1)])):P("",!0)]),_:1},8,["modelValue","search","rules","options"]),o(m,{modelValue:n.value.team,"onUpdate:modelValue":t[3]||(t[3]=e=>n.value.team=e),search:$.value,"onUpdate:search":t[4]||(t[4]=e=>$.value=e),label:"Team","text-by":"fullname","track-by":"id","value-by":"id",multiple:"",rules:[e=>"length"in e&&e.length>0||"This field is required"],options:s(x).items,"max-visible-options":a.$vaBreakpoint.mdUp?3:1},{content:i(({valueArray:e})=>[e!=null&&e.length?(r(!0),b(q,{key:0},A(e,(C,O)=>(r(),b("div",{key:C.id,class:"flex items-center gap-1 mr-2"},[C?(r(),S(L,{key:0,user:C,size:"18px"},null,8,["user"])):P("",!0),B(" "+k(C.fullname)+k(O<e.length-1?",":""),1)]))),128)):P("",!0)]),_:1},8,["modelValue","search","rules","options","max-visible-options"]),o(m,{modelValue:n.value.status,"onUpdate:modelValue":t[5]||(t[5]=e=>n.value.status=e),label:"Status",rules:[p],"track-by":"value","value-by":"value",options:[{text:"In progress",value:"in progress"},{text:"Archived",value:"archived"},{text:"Completed",value:"completed"},{text:"Important",value:"important"}]},{content:i(({value:e})=>[e?(r(),S(M,{key:0,status:e.value},null,8,["status"])):P("",!0)]),_:1},8,["modelValue","rules"]),c("div",we,[o(U,{preset:"secondary",color:"secondary",onClick:t[6]||(t[6]=e=>a.$emit("close"))},{default:i(()=>t[7]||(t[7]=[B("Cancel")])),_:1}),o(U,{onClick:e=>D()&&a.$emit("save",n.value)},{default:i(()=>[B(k(a.saveButtonLabel),1)]),_:2},1032,["onClick"])])]),_:1})}}}),Ce=R(xe,[["__scopeId","data-v-6abead9d"]]),$e={class:"flex flex-col md:flex-row gap-2 mb-2 justify-between"},Pe={class:"flex flex-col md:flex-row gap-2 justify-start"},Be={key:0,class:"va-h5 mb-4"},Se={key:1,class:"va-h5 mb-4"},Fe=F({__name:"ProjectsPage",setup(y){const g=oe("projects-view",!0),{projects:u,update:v,add:n,isLoading:w,remove:x,pagination:p,sorting:f}=ae(),{users:$,getTeamOptions:a,getUserById:t}=se();le("ProjectsPage",{users:$,getTeamOptions:a,getUserById:t});const j=T(null),m=T(!1),U=_=>{j.value=_,m.value=!0},h=()=>{j.value=null,m.value=!0},{init:D}=ie(),e=async _=>{m.value=!1,"id"in _?(await v(_),D({message:"Project updated",color:"success"})):(await n(_),D({message:"Project created",color:"success"}))},{confirm:C}=re(),O=async _=>{await C({title:"Delete project",message:`Are you sure you want to delete project "${_.project_name}"?`,okText:"Delete",size:"small",maxWidth:"380px"})&&(await x(_),D({message:"Project deleted",color:"success"}))},z=T(),H=async _=>{z.value.isFormHasUnsavedChanges?await C({maxWidth:"380px",message:"Form has unsaved changes. Are you sure you want to close it?",size:"small"})&&_():_()};return(_,d)=>{const W=l("VaButtonToggle"),J=l("VaButton"),K=l("VaCardContent"),Q=l("VaModal"),X=l("VaCard");return r(),b(q,null,[d[6]||(d[6]=c("h1",{class:"page-title"},"Projects",-1)),o(X,null,{default:i(()=>[o(K,null,{default:i(()=>[c("div",$e,[c("div",Pe,[o(W,{modelValue:s(g),"onUpdate:modelValue":d[0]||(d[0]=V=>I(g)?g.value=V:null),color:"background-element","border-color":"background-element",options:[{label:"Cards",value:!0},{label:"Table",value:!1}]},null,8,["modelValue"])]),o(J,{icon:"add",onClick:h},{default:i(()=>d[5]||(d[5]=[B("Project")])),_:1})]),s(g)?(r(),S(ve,{key:0,projects:s(u),loading:s(w),onEdit:U,onDelete:O},null,8,["projects","loading"])):(r(),S(ke,{key:1,"sort-by":s(f).sortBy,"onUpdate:sortBy":d[1]||(d[1]=V=>s(f).sortBy=V),"sorting-order":s(f).sortingOrder,"onUpdate:sortingOrder":d[2]||(d[2]=V=>s(f).sortingOrder=V),pagination:s(p),"onUpdate:pagination":d[3]||(d[3]=V=>I(p)?p.value=V:null),projects:s(u),loading:s(w),onEdit:U,onDelete:O},null,8,["sort-by","sorting-order","pagination","projects","loading"]))]),_:1}),o(Q,{modelValue:m.value,"onUpdate:modelValue":d[4]||(d[4]=V=>m.value=V),size:"small","mobile-fullscreen":"","close-button":"",stateful:"","hide-default-actions":"","before-cancel":H},{default:i(({cancel:V,ok:Y})=>[j.value===null?(r(),b("h1",Be,"Add project")):(r(),b("h1",Se,"Edit project")),o(Ce,{ref_key:"editFormRef",ref:z,project:j.value,"save-button-label":j.value===null?"Add":"Save",onClose:V,onSave:Z=>{e(Z),Y()}},null,8,["project","save-button-label","onClose","onSave"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{Fe as default};
//# sourceMappingURL=ProjectsPage-CFDHYngd.js.map
