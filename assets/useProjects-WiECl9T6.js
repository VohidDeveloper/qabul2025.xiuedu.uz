import{g as k,r as G,e as K,k as q,u as T,o as X,n as R,h as S,S as Q,K as F,T as Y,U as Z,W as M,j as I,X as ee,O as j,M as $}from"./index-BZ-BXCh5.js";const He=e=>e,ke=k({__name:"UserAvatar",props:{user:{type:Object,required:!0},size:{type:String,default:"medium"}},setup(e){const t=a=>{const s=["primary","#FFD43A","#ADFF00","#262824","danger"],o=a.charCodeAt(0)%s.length;return s[o]},n=a=>a?a.startsWith("http")||a.startsWith("blob:"):!1,r=a=>{try{const[s,o]=a.split(" ");return`${s[0]}${o[0]}`}catch{return a[0]}};return(a,s)=>{const o=G("VaAvatar");return K(),q(o,{size:e.size,src:n(e.user.avatar)?e.user.avatar:"","fallback-text":r(e.user.fullname),color:t(e.user.fullname)},null,8,["size","src","fallback-text","color"])}}});function te(e){return Y()?(Z(e),!0):!1}function J(e){return typeof e=="function"?e():T(e)}const ne=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const re=e=>typeof e<"u",ae=Object.prototype.toString,se=e=>ae.call(e)==="[object Object]",oe=()=>{};function ie(e,t){function n(...r){return new Promise((a,s)=>{Promise.resolve(e(()=>t.apply(this,r),{fn:t,thisArg:this,args:r})).then(a).catch(s)})}return n}const B=e=>e();function ue(e=B){const t=S(!0);function n(){t.value=!1}function r(){t.value=!0}const a=(...s)=>{t.value&&e(...s)};return{isActive:Q(t),pause:n,resume:r,eventFilter:a}}function ce(e){return M()}function le(e,t,n={}){const{eventFilter:r=B,...a}=n;return F(e,ie(r,t),a)}function de(e,t,n={}){const{eventFilter:r,...a}=n,{eventFilter:s,pause:o,resume:f,isActive:p}=ue(r);return{stop:le(e,t,{...a,eventFilter:s}),pause:o,resume:f,isActive:p}}function fe(e,t=!0,n){ce()?X(e,n):t?e():R(e)}function pe(e){var t;const n=J(e);return(t=n==null?void 0:n.$el)!=null?t:n}const _=ne?window:void 0;function L(...e){let t,n,r,a;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,r,a]=e,t=_):[t,n,r,a]=e,!t)return oe;Array.isArray(n)||(n=[n]),Array.isArray(r)||(r=[r]);const s=[],o=()=>{s.forEach(i=>i()),s.length=0},f=(i,u,g,l)=>(i.addEventListener(u,g,l),()=>i.removeEventListener(u,g,l)),p=F(()=>[pe(t),J(a)],([i,u])=>{if(o(),!i)return;const g=se(u)?{...u}:u;s.push(...n.flatMap(l=>r.map(y=>f(i,l,y,g))))},{immediate:!0,flush:"post"}),d=()=>{p(),o()};return te(d),d}function ge(e){return JSON.parse(JSON.stringify(e))}const E=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},N="__vueuse_ssr_handlers__",me=ye();function ye(){return N in E||(E[N]=E[N]||{}),E[N]}function ve(e,t){return me[e]||t}function he(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"?"object":Number.isNaN(e)?"any":"number"}const we={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}},W="vueuse-storage";function Se(e,t,n,r={}){var a;const{flush:s="pre",deep:o=!0,listenToStorageChanges:f=!0,writeDefaults:p=!0,mergeDefaults:d=!1,shallow:i,window:u=_,eventFilter:g,onError:l=c=>{console.error(c)},initOnMounted:y}=r,w=(i?ee:S)(t);if(!n)try{n=ve("getDefaultStorage",()=>{var c;return(c=_)==null?void 0:c.localStorage})()}catch(c){l(c)}if(!n)return w;const b=J(t),D=he(b),O=(a=r.serializer)!=null?a:we[D],{pause:v,resume:P}=de(w,()=>U(w.value),{flush:s,deep:o,eventFilter:g});return u&&f&&fe(()=>{L(u,"storage",C),L(u,W,H),y&&C()}),y||C(),w;function U(c){try{if(c==null)n.removeItem(e);else{const h=O.write(c),A=n.getItem(e);A!==h&&(n.setItem(e,h),u&&u.dispatchEvent(new CustomEvent(W,{detail:{key:e,oldValue:A,newValue:h,storageArea:n}})))}}catch(h){l(h)}}function x(c){const h=c?c.newValue:n.getItem(e);if(h==null)return p&&b!=null&&n.setItem(e,O.write(b)),b;if(!c&&d){const A=O.read(h);return typeof d=="function"?d(A,b):D==="object"&&!Array.isArray(A)?{...b,...A}:A}else return typeof h!="string"?h:O.read(h)}function H(c){C(c.detail)}function C(c){if(!(c&&c.storageArea!==n)){if(c&&c.key==null){w.value=b;return}if(!(c&&c.key!==e)){v();try{(c==null?void 0:c.newValue)!==O.write(w.value)&&(w.value=x(c))}catch(h){l(h)}finally{c?R(P):P()}}}}}function Ge(e,t,n={}){const{window:r=_}=n;return Se(e,t,r==null?void 0:r.localStorage,n)}function Ke(e,t,n,r={}){var a,s,o;const{clone:f=!1,passive:p=!1,eventName:d,deep:i=!1,defaultValue:u,shouldEmit:g}=r,l=M(),y=n||(l==null?void 0:l.emit)||((a=l==null?void 0:l.$emit)==null?void 0:a.bind(l))||((o=(s=l==null?void 0:l.proxy)==null?void 0:s.$emit)==null?void 0:o.bind(l==null?void 0:l.proxy));let w=d;t||(t="modelValue"),w=w||`update:${t.toString()}`;const b=v=>f?typeof f=="function"?f(v):ge(v):v,D=()=>re(e[t])?b(e[t]):u,O=v=>{g?g(v)&&y(w,v):y(w,v)};if(p){const v=D(),P=S(v);let U=!1;return F(()=>e[t],x=>{U||(U=!0,P.value=b(x),R(()=>U=!1))}),F(P,x=>{!U&&(x!==e[t]||i)&&O(x)},{deep:i}),P}else return I({get(){return D()},set(v){O(v)}})}const be=async e=>{const t=await fetch(j.allProjects()).then(n=>n.json());return{data:t,pagination:{page:e.page,perPage:e.perPage,total:t.length}}},je=async e=>{const t=new Headers;return t.append("Content-Type","application/json"),fetch(j.allProjects(),{method:"POST",body:JSON.stringify(e),headers:t}).then(n=>n.json())},Oe=async e=>{const t=new Headers;return t.append("Content-Type","application/json"),fetch(j.project(e.id),{method:"PUT",body:JSON.stringify(e),headers:t}).then(n=>n.json())},Ae=async e=>fetch(j.project(e.id),{method:"DELETE"}),Pe=$("projects",{state:()=>({items:[],pagination:{page:1,perPage:10,total:0}}),actions:{async getAll(e){const{data:t,pagination:n}=await be({...e.sorting,...e.pagination});this.items=t,this.pagination=n},async add(e){const[t]=await je(e);this.items.push(t)},async update(e){const[t]=await Oe(e),n=this.items.findIndex(({id:r})=>r===e.id);this.items.splice(n,1,t)},async remove(e){if(await Ae(e)){const n=this.items.findIndex(({id:r})=>r===e.id);this.items.splice(n,1)}}}}),m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));function Ue(e,t=0){return(m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+"-"+m[e[t+4]]+m[e[t+5]]+"-"+m[e[t+6]]+m[e[t+7]]+"-"+m[e[t+8]]+m[e[t+9]]+"-"+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]).toLowerCase()}let V;const xe=new Uint8Array(16);function Te(){if(!V){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");V=crypto.getRandomValues.bind(crypto)}return V(xe)}const De=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),z={randomUUID:De};function Fe(e,t,n){if(z.randomUUID&&!t&&!e)return z.randomUUID();e=e||{};const r=e.random||(e.rng||Te)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Ue(r)}const Ce=async e=>{const{isActive:t,search:n}=e;let r=await fetch(j.allUsers()).then(o=>o.json());r=r.filter(o=>o.active===t),n&&(r=r.filter(o=>o.fullname.toLowerCase().includes(n.toLowerCase())));const{page:a=1,perPage:s=10}=e||{};return{data:r,pagination:{page:a,perPage:s,total:r.length}}},Ee=async e=>{const t=new Headers;t.append("Content-Type","application/json");const n=await fetch(j.allUsers(),{method:"POST",body:JSON.stringify(e),headers:t}).then(r=>r.json());if(!n.error)return n;throw new Error(n.error)},Ne=async e=>{const t=new Headers;t.append("Content-Type","application/json");const n=await fetch(j.user(e.id),{method:"PUT",body:JSON.stringify(e),headers:t}).then(r=>r.json());if(!n.error)return n;throw new Error(n.error)},_e=async e=>fetch(j.user(e.id),{method:"DELETE"}),Ve=async e=>fetch(j.avatars(),{method:"POST",body:e,redirect:"follow"}).then(t=>t.json()),Re=$("users",{state:()=>({items:[],pagination:{page:1,perPage:10,total:0}}),actions:{async getAll(e){const{data:t,pagination:n}=await Ce({...e.filters,...e.sorting,...e.pagination});this.items=t,this.pagination=n},async add(e){const[t]=await Ee(e);return this.items.unshift(t),t},async update(e){const[t]=await Ne(e),n=this.items.findIndex(({id:r})=>r===e.id);return this.items.splice(n,1,t),t},async remove(e){if(await _e(e)){const n=this.items.findIndex(({id:r})=>r===e.id);this.items.splice(n,1)}},async uploadAvatar(e){return Ve(e)}}}),Ie=()=>S({page:1,perPage:10,total:0}),Je=()=>S({sortBy:"fullname",sortingOrder:null}),Le=()=>S({isActive:!0,search:""}),We=e=>{const t=S(!1),n=S(),r=Re(),{filters:a=Le(),sorting:s=Je(),pagination:o=Ie()}={},f=async()=>{t.value=!0;try{await r.getAll({filters:T(a),sorting:T(s),pagination:T(o)}),o.value=r.pagination}finally{t.value=!1}};F(a,()=>{o.value.page=1,f()},{deep:!0}),f();const p=I(()=>{const d=(u,g)=>g==="projects"?u.projects.map(l=>l).join(", "):u[g],i=r.items.slice((o.value.page-1)*o.value.perPage,o.value.page*o.value.perPage);return s.value.sortBy&&s.value.sortingOrder&&i.sort((u,g)=>{const l=d(u,s.value.sortBy),y=d(g,s.value.sortBy);return l>y?s.value.sortingOrder==="asc"?1:-1:l<y?s.value.sortingOrder==="asc"?-1:1:0}),i});return{error:n,isLoading:t,filters:a,sorting:s,pagination:o,users:p,fetch:f,async add(d){t.value=!0;try{return await r.add(d)}catch(i){n.value=i}finally{t.value=!1}},async update(d){t.value=!0;try{return await r.update(d)}catch(i){n.value=i}finally{t.value=!1}},async remove(d){t.value=!0;try{return await r.remove(d)}catch(i){n.value=i}finally{t.value=!1}},async uploadAvatar(d){const i=new FormData;return i.append("avatar",d),i.append("id",Fe()),r.uploadAvatar(i)}}};function ze(){const{users:e}=We(),t=a=>e.value.find(({id:s})=>a===s),n=a=>{const s=["primary","#FFD43A","#ADFF00","#262824","danger"],o=a.charCodeAt(0)%s.length;return s[o]};return{users:e,getUserById:t,getTeamOptions:a=>a.reduce((s,o)=>{const f=t(o);return f&&s.push({label:f.fullname,src:f.avatar,fallbackText:f.fullname[0],color:n(f.fullname)}),s},[])}}const Me=()=>S({page:1,perPage:10,total:0}),$e=()=>S({sortBy:"created_at",sortingOrder:"desc"}),qe=e=>{const t=S(!1),n=Pe(),{getUserById:r}=ze(),{sorting:a=$e(),pagination:s=Me()}=e??{},o=async()=>{t.value=!0,await n.getAll({sorting:T(a),pagination:T(s)}),s.value=n.pagination,t.value=!1},f=I(()=>{const p=n.items.slice((s.value.page-1)*s.value.perPage,s.value.page*s.value.perPage),d=(i,u)=>{var g;return u==="project_owner"?(g=r(i.project_owner))==null?void 0:g.fullname:u==="team"?i.team.map(l=>{var y;return((y=r(l))==null?void 0:y.fullname)||""}).join(", "):u==="created_at"?new Date(i[u]):i[u]};return a.value.sortBy&&a.value.sortingOrder&&p.sort((i,u)=>(i=d(i,a.value.sortBy),u=d(u,a.value.sortBy),i<u?a.value.sortingOrder==="asc"?-1:1:i>u?a.value.sortingOrder==="asc"?1:-1:0)),p});return o(),{isLoading:t,projects:f,fetch:o,async add(p){t.value=!0,await n.add(p),await o(),t.value=!1},async update(p){t.value=!0,await n.update(p),await o(),t.value=!1},async remove(p){t.value=!0,await n.remove(p),await o(),t.value=!1},pagination:s,sorting:a}};export{ke as _,qe as a,We as b,Re as c,He as d,Ge as e,ze as f,Ke as u};
//# sourceMappingURL=useProjects-WiECl9T6.js.map
